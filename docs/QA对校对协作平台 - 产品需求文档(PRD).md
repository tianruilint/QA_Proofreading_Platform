# QA对校对协作平台 - 产品需求文档(PRD)

## 1. 文档信息
- **文档版本**: V2.0
- **创建日期**: 2025-07-29
- **产品名称**: QA对校对协作平台
- **文档状态**: 正式版

## 2. 产品概述

### 2.1 产品背景
随着AI技术的发展，QA对的自动生成已成为常态。然而，自动生成的QA对往往存在语义、语法或事实性错误，需要人工进行高质量的校对和修正。当QA对数据量庞大时，传统的单人校对模式效率低下，且难以保证一致性。因此，一个支持多人协作、高效管理的QA对校对平台变得至关重要。

### 2.2 产品定位
QA对校对协作平台是一个专为团队设计的Web应用程序，旨在提供一个高效、可视化的环境，用于批量QA对的审阅、编辑、质量控制和协作。它支持单文件快速校对和复杂的多用户任务分配与追踪，确保QA数据的准确性和一致性。

### 2.3 目标用户
- **数据标注团队**: 负责QA对数据清洗、校对和质量控制的专业人员。
- **内容审核人员**: 需要对AI生成或人工录入的问答内容进行审核和修正的人员。
- **项目管理员**: 负责分配任务、追踪进度和管理团队成员的负责人。

### 2.4 核心价值
- **提升校对效率**: 提供直观的编辑界面和批量操作功能，显著加快校对速度。
- **强化团队协作**: 支持任务拆分与分配，实现多人并行工作，提高整体产出。
- **确保数据质量**: 通过严格的权限控制和版本管理（隐式），保障QA对数据的准确性和一致性。
- **简化工作流程**: 统一的文件上传、编辑、导出流程，降低操作复杂性。
- **数据可追溯性**: 记录QA对的编辑历史，便于质量复查和问题追溯。

## 3. 功能需求

### 3.1 用户认证与权限管理

#### 3.1.1 功能描述
平台提供多角色用户认证机制，确保数据安全和操作权限的合理分配。

#### 3.1.2 功能详情
- **用户登录**: 用户通过选择预设的用户名进行登录。系统支持以下角色：
  - **超级管理员 (super_admin)**: 拥有最高权限，可管理所有用户、用户组、管理员组，并查看所有任务数据。
  - **管理员 (admin)**: 可管理其所属管理员组下的用户组和用户，并创建、管理和导出协作任务。
  - **普通用户 (user)**: 可进行单文件校对，接受并完成分配的协作任务，查看自己的任务列表。
  - **访客 (guest)**: 无需登录即可使用单文件校对功能，数据仅在本地浏览器临时存储，不与后端交互，关闭页面后数据清除。
- **会话管理**: 登录用户通过JWT（JSON Web Token）进行认证，所有受保护的API请求需携带有效的`session_token`。
- **权限控制**: 
  - 单文件校对任务：用户只能访问自己创建的会话。
  - 协作任务：用户只能访问分配给自己的QA对部分；任务创建者（管理员）可查看整个任务详情并进行合并导出。
  - 用户管理：仅超级管理员和管理员可访问用户管理页面。

### 3.2 单文件校对模块

#### 3.2.1 功能描述
用户可上传JSONL文件，进行独立的QA对校对、编辑和导出。

#### 3.2.2 功能详情
- **文件上传**: 支持上传JSONL格式文件。系统对文件内容进行校验，确保每行是包含`prompt`和`completion`字段的有效JSON对象。
- **QA对展示与编辑**: 
  - QA对以列表形式分页展示，每页20条，支持分页导航。
  - 每个QA对的`prompt`和`completion`字段均可在线编辑。
  - 支持标记QA对为“已删除”（`is_deleted`字段）。
  - 实时保存编辑内容（隐式自动保存）。
- **搜索功能**: 支持根据关键词搜索`prompt`和`completion`内容，进行快速定位。
- **数据导出**: 
  - **导出为JSONL**: 将当前会话中所有未标记为删除的QA对导出为JSONL格式。文件名格式：`原文件名_edited_时间戳.jsonl`。
  - **导出为Excel**: 将当前会话中所有未标记为删除的QA对导出为Excel格式。Excel包含“问题(prompt)”和“答案(completion)”两列。文件名格式：`原文件名_时间戳.xlsx`。

### 3.3 协作任务模块

#### 3.3.1 功能描述
管理员可创建协作任务，将大型QA对文件拆分并分配给多个用户进行并行校对，并追踪任务进度和合并结果。

#### 3.3.2 功能详情
- **任务创建**: 
  - 管理员上传JSONL文件，并指定任务名称。
  - **任务分配**: 支持将QA对按数量分配给选定的用户。可选择平均分配或手动指定每个用户的分配数量。
  - 任务创建者（管理员）自动成为任务的负责人，拥有最终合并和导出的权限。
- **任务详情与进度追踪**: 
  - 任务创建者可查看任务的整体状态（待处理、进行中、已完成）和每个分配任务的详细进度（未开始、进行中、已提交、已完成）。
  - 显示总QA对数量、已完成分配数量、总分配数量和整体完成百分比。
- **协作编辑**: 
  - 被分配任务的用户只能看到并编辑分配给自己的QA对部分。
  - 编辑界面与单文件校对模块类似，支持编辑、标记删除和搜索。
- **任务提交**: 
  - 用户完成分配的QA对后，可提交自己的任务部分。系统记录提交时间。
  - 支持多次提交，以最后一次提交的内容为准。
- **合并与导出**: 
  - 仅任务创建者可在所有分配任务都提交后，将所有已完成的QA对合并为一个完整文件。
  - 支持导出为JSONL和Excel格式。导出文件包含所有未被标记为删除的QA对。

### 3.4 任务列表模块

#### 3.4.1 功能描述
为用户提供一个统一的入口，查看和管理其所有待处理和已完成的校对任务。

#### 3.4.2 功能详情
- **待办任务列表**: 
  - 展示当前用户所有未完成的单文件校对会话和待处理的协作任务分配。
  - 显示任务名称、类型（单文件/协作）、创建时间、相关用户（协作任务的创建者）、QA对数量（单文件为总数，协作任务为分配给自己的部分）。
  - 点击任务可进入相应的编辑界面。
- **已完成任务列表**: 
  - 展示当前用户已完成的单文件校对会话和已提交的协作任务分配。
  - 提供已导出文件的下载链接（若有）。
  - 已完成任务及其导出文件将保留24小时，之后自动清理。

### 3.5 系统管理模块 (管理员功能)

#### 3.5.1 功能描述
提供用户和用户组管理功能，以及数据追溯能力。

#### 3.5.2 功能详情
- **用户管理**: 
  - 超级管理员和管理员可查看、添加、编辑和删除用户。
  - 支持为用户分配角色（管理员、普通用户）和所属用户组/管理员组。
- **用户组管理**: 
  - 超级管理员和管理员可创建、编辑和删除用户组。
  - 用户组用于组织普通用户，便于任务分配和权限管理。
- **管理员组管理**: 
  - 超级管理员可创建、编辑和删除管理员组。
  - 管理员组用于组织管理员，并可关联多个用户组，实现更细粒度的权限控制。
- **数据追溯 (Traceability View)**: 
  - 提供QA对的编辑历史和操作记录，便于质量审计和问题排查。
  - 可查看特定QA对的修改前后对比，以及修改人、修改时间等信息。

## 4. 非功能需求

### 4.1 性能需求
- **文件处理**: 支持单文件处理高达50,000条QA对。
- **响应时间**: 
  - 页面加载时间：平均 < 3秒。
  - QA对列表加载：平均 < 1秒。
  - 文件上传/下载：< 5秒（针对10MB文件）。
- **并发**: 支持至少20个用户同时在线进行协作编辑。

### 4.2 兼容性需求
- **浏览器**: 支持最新版本的Chrome、Firefox、Edge。
- **设备**: 响应式设计，兼容桌面浏览器和主流平板设备。
- **部署环境**: 兼容Linux (Ubuntu) 操作系统，可部署于内网环境。

### 4.3 安全性需求
- **数据传输**: 前后端通信采用HTTPS加密（部署时配置Nginx）。
- **认证授权**: 严格的JWT认证和基于角色的权限控制，确保用户只能访问其被授权的数据和功能。
- **数据隔离**: 确保不同用户、不同任务之间的数据隔离，防止越权访问。
- **数据清理**: 定期自动清理过期会话和已完成任务的临时文件。

### 4.4 可用性需求
- **用户界面**: 简洁直观的UI设计，降低学习成本，提高操作效率。
- **错误处理**: 提供清晰、友好的错误提示和操作反馈。
- **操作便捷性**: 支持键盘快捷键操作（如保存、切换QA对），提供批量操作功能。
- **稳定性**: 系统应具备高稳定性，减少崩溃和数据丢失的风险。

## 5. 界面设计要求

### 5.1 整体布局
- **顶部导航栏**: 包含Logo、当前用户信息、登录/登出按钮、全局功能入口（如系统管理）。
- **左侧边栏**: 可折叠的任务列表，区分“待办”和“已完成”任务，并显示任务类型和进度。
- **主工作区**: 根据当前选中的功能模块动态加载内容，如文件上传区、QA对编辑区、任务详情区、用户管理区等。
- **底部操作区**: 包含与当前页面功能相关的操作按钮（如保存、导出、提交、分配等）。

### 5.2 交互设计
- **文件上传**: 支持拖拽上传和点击选择文件。
- **QA对编辑**: 
  - QA对卡片或行内编辑模式，支持直接修改文本。
  - 标记删除功能，视觉上区分已删除QA对。
  - 导航按钮（上一条/下一条）和跳转到指定QA对的功能。
- **任务分配**: 直观的用户选择界面和数量分配输入框。
- **进度展示**: 进度条和数字百分比结合，清晰展示任务完成度。
- **响应式设计**: 界面元素和布局能根据屏幕尺寸自适应调整。

## 6. 技术栈

### 6.1 前端技术栈
- **核心框架**: React 18.x
- **构建工具**: Vite 4.x
- **UI组件**: 
  - `lucide-react` (图标库)
  - `clsx`, `tailwind-merge` (CSS工具)
  - **样式**: Tailwind CSS 3.x, PostCSS, App.css (自定义样式)
- **路由**: `react-router-dom` 6.x
- **状态管理**: React Hooks (`useAuth`等自定义Hook)

### 6.2 后端技术栈
- **核心框架**: Flask 3.x
- **数据库**: 
  - SQLAlchemy (ORM)
  - SQLite (开发/测试环境默认)
  - PostgreSQL (推荐生产环境)
- **认证**: PyJWT 2.x, bcrypt (密码哈希)
- **API**: RESTful API，通过`flask_cors`支持跨域请求。
- **文件处理**: `openpyxl` (Excel读写)
- **缓存**: `redis` (requirements.txt中存在，表明有预留或计划使用)
- **其他**: `python-dotenv`, `Werkzeug`。

### 6.3 部署相关
- **Web服务器**: Gunicorn (生产环境推荐)
- **反向代理**: Nginx (生产环境推荐，用于HTTPS和负载均衡)

## 7. 风险与应对

### 7.1 技术风险
- **大文件处理性能瓶颈**: 
  - **应对**: 前端采用分页加载，后端对文件进行流式处理和分块存储。数据库查询优化，建立必要索引。
- **并发编辑冲突**: 
  - **应对**: 后端对QA对的更新操作进行原子性处理，并记录`last_edited_at`时间戳，前端在提交时可进行版本校验，提示用户可能存在的冲突。
- **数据一致性**: 
  - **应对**: 数据库事务管理，确保数据操作的完整性。定期数据备份。

### 7.2 运营风险
- **用户操作失误导致数据丢失**: 
  - **应对**: 提供“标记删除”而非物理删除，允许恢复。自动保存草稿功能。重要操作前进行二次确认。
- **系统资源耗尽**: 
  - **应对**: 实施文件大小、QA对数量、会话数量等配额限制。定期清理过期数据和临时文件。

## 8. 附录

### 8.1 JSONL文件格式示例
```json
{"prompt": "设摊审批需要通过哪个系统进行？", "completion": "设摊审批需要通过教工OA系统进行。"}
{"prompt": "借用书院功能性用房的钥匙归还时间限制是什么？", "completion": "借用书院功能性用房的钥匙需在借用当天20:00前归还。"}
```

### 8.2 Excel文件格式示例
| 序号 | 问题(prompt) | 答案(completion) |
|------|--------------|------------------|
| 1 | 设摊审批需要通过哪个系统进行？ | 设摊审批需要通过教工OA系统进行。 |
| 2 | 借用书院功能性用房的钥匙归还时间限制是什么？ | 借用书院功能性用房的钥匙需在借用当天20:00前归还。 |

