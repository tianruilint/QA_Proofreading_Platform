# QA Proofreading Collaboration Platform - Product Requirements Document (PRD)

## 1. Document Information
- **Document Version**: V2.0
- **Creation Date**: 2025-07-29
- **Product Name**: QA Proofreading Collaboration Platform
- **Document Status**: Final

## 2. Product Overview

### 2.1 Product Background
With the advancement of AI technology, automatic generation of QA pairs has become commonplace. However, automatically generated QA pairs often contain semantic, grammatical, or factual errors, requiring manual, high-quality proofreading and correction. When the volume of QA data is large, the traditional single-person proofreading model is inefficient and difficult to ensure consistency. Therefore, a QA proofreading platform that supports multi-person collaboration and efficient management has become crucial.

### 2.2 Product Positioning
The QA Proofreading Collaboration Platform is a web application specifically designed for teams, aiming to provide an efficient, visual environment for batch review, editing, quality control, and collaboration on QA pair files. It supports rapid single-file proofreading and complex multi-user task assignment and tracking, ensuring the accuracy and consistency of QA data.

### 2.3 Target Users
- **Data Annotation Teams**: Professionals responsible for cleaning, proofreading, and quality controlling QA pair data.
- **Content Reviewers**: Individuals who need to review and correct question-and-answer content generated by AI or manually entered.
- **Project Administrators**: Leaders responsible for assigning tasks, tracking progress, and managing team members.

### 2.4 Core Value
- **Improved Proofreading Efficiency**: Provides an intuitive editing interface and batch operation functions, significantly accelerating proofreading speed.
- **Enhanced Team Collaboration**: Supports task splitting and assignment, enabling parallel work among multiple people, and increasing overall output.
- **Ensured Data Quality**: Guarantees the accuracy and consistency of QA pair data through strict permission control and (implicit) version management.
- **Simplified Workflow**: Unified file upload, editing, and export processes reduce operational complexity.
- **Data Traceability**: Records the editing history of QA pairs, facilitating quality audits and problem tracing.

## 3. Functional Requirements

### 3.1 User Authentication and Permission Management

#### 3.1.1 Feature Description
The platform provides a multi-role user authentication mechanism to ensure data security and proper allocation of operational permissions.

#### 3.1.2 Feature Details
- **User Login**: Users log in by selecting their pre-configured username. The system supports the following roles:
  - **Super Administrator (super_admin)**: Has the highest privileges, can manage all users, user groups, admin groups, and view all task data.
  - **Administrator (admin)**: Can manage user groups and users under their assigned admin group, and create, manage, and export collaborative tasks.
  - **Regular User (user)**: Can perform single-file proofreading, accept and complete assigned collaborative tasks, and view their task list.
  - **Guest (guest)**: Can use the single-file proofreading function without logging in. Data is temporarily stored locally in the browser and does not interact with the backend. Data is cleared upon closing the page.
- **Session Management**: Logged-in users are authenticated via JWT (JSON Web Token). All protected API requests must carry a valid `session_token`.
- **Permission Control**: 
  - Single-file proofreading tasks: Users can only access sessions they created.
  - Collaborative tasks: Users can only access the QA pair portions assigned to them; the task creator (administrator) can view the entire task details and perform merging and exporting.
  - User Management: Only super administrators and administrators can access the user management page.

### 3.2 Single-File Proofreading Module

#### 3.2.1 Feature Description
Users can upload JSONL files for independent QA pair proofreading, editing, and exporting.

#### 3.2.2 Feature Details
- **File Upload**: Supports uploading JSONL formatted files. The system validates file content to ensure each line is a valid JSON object containing `prompt` and `completion` fields.
- **QA Pair Display and Editing**: 
  - QA pairs are displayed in a paginated list, 20 items per page, with pagination navigation support.
  - Both `prompt` and `completion` fields of each QA pair can be edited online.
  - Supports marking QA pairs as 


“deleted” (`is_deleted` field).
  - Real-time saving of edits (implicit auto-save).
- **Search Function**: Supports searching `prompt` and `completion` content by keywords for quick location.
- **Data Export**: 
  - **Export to JSONL**: Exports all QA pairs not marked as deleted in the current session to JSONL format. Filename format: `original_filename_edited_timestamp.jsonl`.
  - **Export to Excel**: Exports all QA pairs not marked as deleted in the current session to Excel format. Excel includes “Question (prompt)” and “Answer (completion)” columns. Filename format: `original_filename_timestamp.xlsx`.

### 3.3 Collaborative Task Module

#### 3.3.1 Feature Description
Administrators can create collaborative tasks, split large QA pair files, and assign them to multiple users for parallel proofreading, then track task progress and merge results.

#### 3.3.2 Feature Details
- **Task Creation**: 
  - Administrators upload JSONL files and specify a task name.
  - **Task Assignment**: Supports assigning QA pairs by quantity to selected users. Can choose average distribution or manually specify the quantity for each user.
  - The task creator (administrator) automatically becomes the task owner, with final merging and export permissions.
- **Task Details and Progress Tracking**: 
  - The task creator can view the overall status of the task (pending, in progress, completed) and the detailed progress of each assigned task (not started, in progress, submitted, completed).
  - Displays total QA pair count, completed assignment count, total assignment count, and overall completion percentage.
- **Collaborative Editing**: 
  - Users assigned to a task can only see and edit the QA pair portions assigned to them.
  - The editing interface is similar to the single-file proofreading module, supporting editing, marking for deletion, and searching.
- **Task Submission**: 
  - After completing their assigned QA pairs, users can submit their task portions. The system records the submission time.
  - Multiple submissions are supported, with the last submission taking precedence.
- **Merge and Export**: 
  - Only the task creator can merge all completed QA pairs into a single file after all assigned tasks have been submitted.
  - Supports export to JSONL and Excel formats. Exported files include all QA pairs not marked for deletion.

### 3.4 Task List Module

#### 3.4.1 Feature Description
Provides a unified entry point for users to view and manage all their pending and completed proofreading tasks.

#### 3.4.2 Feature Details
- **Pending Task List**: 
  - Displays all uncompleted single-file proofreading sessions and pending collaborative task assignments for the current user.
  - Shows task name, type (single-file/collaborative), creation time, related user (creator of collaborative task), and QA pair count (total for single-file, assigned portion for collaborative).
  - Clicking a task navigates to the corresponding editing interface.
- **Completed Task List**: 
  - Displays completed single-file proofreading sessions and submitted collaborative task assignments for the current user.
  - Provides download links for exported files (if available).
  - Completed tasks and their exported files are retained for 24 hours, then automatically cleaned up.

### 3.5 System Management Module (Administrator Functions)

#### 3.5.1 Feature Description
Provides user and user group management functions, as well as data traceability capabilities.

#### 3.5.2 Feature Details
- **User Management**: 
  - Super administrators and administrators can view, add, edit, and delete users.
  - Supports assigning roles (administrator, regular user) and associated user groups/admin groups to users.
- **User Group Management**: 
  - Super administrators and administrators can create, edit, and delete user groups.
  - User groups are used to organize regular users, facilitating task assignment and permission management.
- **Admin Group Management**: 
  - Super administrators can create, edit, and delete admin groups.
  - Admin groups are used to organize administrators and can be associated with multiple user groups for more granular permission control.
- **Data Traceability (Traceability View)**: 
  - Provides editing history and operation logs of QA pairs, facilitating quality audits and problem investigation.
  - Allows viewing before-and-after comparisons of specific QA pair modifications, as well as modifier, modification time, etc.

## 4. Non-Functional Requirements

### 4.1 Performance Requirements
- **File Processing**: Supports processing up to 50,000 QA pairs in a single file.
- **Response Time**: 
  - Page load time: Average < 3 seconds.
  - QA pair list load: Average < 1 second.
  - File upload/download: < 5 seconds (for 10MB files).
- **Concurrency**: Supports at least 20 concurrent users for collaborative editing.

### 4.2 Compatibility Requirements
- **Browsers**: Supports the latest versions of Chrome, Firefox, Edge.
- **Devices**: Responsive design, compatible with desktop browsers and mainstream tablet devices.
- **Deployment Environment**: Compatible with Linux (Ubuntu) operating system, deployable within an intranet environment.

### 4.3 Security Requirements
- **Data Transmission**: Frontend and backend communication uses HTTPS encryption (configured during Nginx deployment).
- **Authentication and Authorization**: Strict JWT authentication and role-based access control ensure users can only access authorized data and functions.
- **Data Isolation**: Ensures data isolation between different users and tasks, preventing unauthorized access.
- **Data Cleanup**: Regular automatic cleanup of expired sessions and temporary files from completed tasks.

### 4.4 Usability Requirements
- **User Interface**: Clean and intuitive UI design, reducing learning curve and improving operational efficiency.
- **Error Handling**: Provides clear and user-friendly error messages and operational feedback.
- **Ease of Use**: Supports keyboard shortcuts (e.g., save, switch QA pairs), provides batch operation functions.
- **Stability**: The system should have high stability, minimizing crashes and data loss risks.

## 5. UI Design Requirements

### 5.1 Overall Layout
- **Top Navigation Bar**: Includes Logo, current user information, login/logout buttons, global function entry points (e.g., System Management).
- **Left Sidebar**: Collapsible task list, distinguishing between “Pending” and “Completed” tasks, and displaying task type and progress.
- **Main Work Area**: Dynamically loads content based on the currently selected function module, such as file upload area, QA pair editing area, task details area, user management area, etc.
- **Bottom Operation Area**: Contains operation buttons related to the current page function (e.g., save, export, submit, assign).

### 5.2 Interaction Design
- **File Upload**: Supports drag-and-drop upload and click-to-select file.
- **QA Pair Editing**: 
  - QA pair card or inline editing mode, supporting direct text modification.
  - Mark for deletion function, visually distinguishing deleted QA pairs.
  - Navigation buttons (previous/next) and jump-to-specific-QA-pair function.
- **Task Assignment**: Intuitive user selection interface and quantity assignment input fields.
- **Progress Display**: Progress bar combined with numerical percentage, clearly showing task completion.
- **Responsive Design**: UI elements and layout adapt automatically to screen size.

## 6. Technology Stack

### 6.1 Frontend Technology Stack
- **Core Framework**: React 18.x
- **Build Tool**: Vite 4.x
- **UI Components**: 
  - `lucide-react` (icon library)
  - `clsx`, `tailwind-merge` (CSS utilities)
  - **Styling**: Tailwind CSS 3.x, PostCSS, App.css (custom styles)
- **Routing**: `react-router-dom` 6.x
- **State Management**: React Hooks (`useAuth` and other custom Hooks)

### 6.2 Backend Technology Stack
- **Core Framework**: Flask 3.x
- **Database**: 
  - SQLAlchemy (ORM)
  - SQLite (default for development/testing environments)
  - PostgreSQL (recommended for production environments)
- **Authentication**: PyJWT 2.x, bcrypt (password hashing)
- **API**: RESTful API, supports cross-origin requests via `flask_cors`.
- **File Handling**: `openpyxl` (Excel read/write)
- **Caching**: `redis` (present in requirements.txt, indicating reserved or planned use)
- **Others**: `python-dotenv`, `Werkzeug`.

### 6.3 Deployment Related
- **Web Server**: Gunicorn (recommended for production environments)
- **Reverse Proxy**: Nginx (recommended for production environments, for HTTPS and load balancing)

## 7. Risks and Countermeasures

### 7.1 Technical Risks
- **Large File Processing Performance Bottleneck**: 
  - **Countermeasure**: Frontend uses paginated loading, backend processes files in streams and stores them in chunks. Database query optimization, creation of necessary indexes.
- **Concurrent Editing Conflicts**: 
  - **Countermeasure**: Backend performs atomic operations for QA pair updates and records `last_edited_at` timestamp. Frontend can perform version checks on submission, alerting users to potential conflicts.
- **Data Consistency**: 
  - **Countermeasure**: Database transaction management to ensure data operation integrity. Regular data backups.

### 7.2 Operational Risks
- **Data Loss due to User Error**: 
  - **Countermeasure**: Provide “mark for deletion” instead of physical deletion, allowing recovery. Auto-save draft function. Secondary confirmation before important operations.
- **System Resource Exhaustion**: 
  - **Countermeasure**: Implement quotas for file size, QA pair count, session count, etc. Regular cleanup of expired data and temporary files.

## 8. Appendix

### 8.1 JSONL File Format Example
```json
{"prompt": "设摊审批需要通过哪个系统进行？", "completion": "设摊审批需要通过教工OA系统进行。"}
{"prompt": "借用书院功能性用房的钥匙归还时间限制是什么？", "completion": "借用书院功能性用房的钥匙需在借用当天20:00前归还。"}
```

### 8.2 Excel File Format Example
| No. | Question (prompt) | Answer (completion) |
|------|--------------|------------------|
| 1 | 设摊审批需要通过哪个系统进行？ | 设摊审批需要通过教工OA系统进行。 |
| 2 | 借用书院功能性用房的钥匙归还时间限制是什么？ | 借用书院功能性用房的钥匙需在借用当天20:00前归还。 |


